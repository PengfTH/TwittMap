<html>
<head>

<script
src="http://maps.google.cn/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false">
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<script type="text/javascript">

	var center = new google.maps.LatLng(40.758896, -73.985130);
	var map;
    var panorama;
    var markers = [];

	function initialize()
	{
		var mapProp = {
		  	center:center,
		  	zoom:2,
		  	mapTypeId:google.maps.MapTypeId.ROADMAP
	  	};
		map = new google.maps.Map(document.getElementById("map-canvas"),mapProp);
        panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'), {position: center});
        map.setStreetView(panorama);

        function searchkw(){
            for(i=0; i<markers.length; i++){
                markers[i].setMap(null);
            }
            markers = [];
            map.setZoom(2);
            var keyword = $("#kw").val()
            $.getJSON('/search/', {'keyword':keyword}, function(res){
                var json = '[' + res + ']';
                $.each(JSON.parse(json), function(idx, obj) {
                    var latLng = new google.maps.LatLng(obj.lat, obj.lng);
                    var marker = new google.maps.Marker({position: latLng, map: map});
                    var info = new google.maps.InfoWindow({ content: '<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">'+obj.usr+'</h1><div id="bodyContent"><p>'+obj.txt+'</p>'});                    

                    marker.addListener('click', function() {
                        map.setZoom(7);
                        map.setCenter(marker.getPosition());
                        info.open(map, marker);
                        panorama.setOptions({position: latLng});
                    });
                    markers.push(marker);
                })
                if (markers.length == 0) {
                    alert('No tweet post recently contains this keyword.');
                }
            })
        }

        google.maps.event.addDomListener(document.getElementById("search"),"click", searchkw);

	}

	google.maps.event.addDomListener(window, 'load', initialize);

</script>
</head>

<body>

<div id="map-canvas" style="width: 60%; height: 100%;float:left"></div>
<div id="pano" style="width: 40%; height: 100%;float:left"></div>

<div style="position:absolute;top:30px;left:150px;">
    <input id="kw" style="width:200px;height:30px;" type="text">
    <button id="search" type="button">Search</button>
</div>

<div id="tagclouds" style="position:absolute;top:70px;right:70px;width:280px;height:280px;">
<script type="text/javascript">
</script>
</div>


</body>
</html>

